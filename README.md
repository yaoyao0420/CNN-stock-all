# CNN-stock-all
说明
使用2018strain集作为训练集，将每支股票拆分成PastDays×FeatureNums的形式，作为一个batch，并把所有股票的batch共同作为训练集，训练集的shape为(2592287, 20, 29, 1)。

输送到模型当中训练，并针对2018stest中的每单支股票进行预测，预测结果分为三种涨、平（change不超过±5%）、跌三类。
参数是
PastDays = 21
n_classes = 3
FeatureNums = 29
batch_size = 32
num_epoch = 2

n_filters = 32
kernel_size = [5, 5]
pool_size = [2, 2]


模型结构为LeNet框架：
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
conv2d_1 (Conv2D)            (None, 16, 25, 6)         156       
_________________________________________________________________
max_pooling2d_1 (MaxPooling2 (None, 8, 12, 6)          0         
_________________________________________________________________
conv2d_2 (Conv2D)            (None, 4, 8, 16)          2416      
_________________________________________________________________
max_pooling2d_2 (MaxPooling2 (None, 2, 4, 16)          0         
_________________________________________________________________
flatten_1 (Flatten)          (None, 128)               0         
_________________________________________________________________
dense_1 (Dense)              (None, 120)               15480     
_________________________________________________________________
dense_2 (Dense)              (None, 84)                10164     
_________________________________________________________________
dense_3 (Dense)              (None, 3)                 255       
=================================================================
Total params: 28,471
Trainable params: 28,471
Non-trainable params: 0
_________________________________________________________________


因为训练集过于庞大，所以训练每一轮（即一个epoch）的训练速度很缓慢，大概需要50分钟左右，【也就是如果epoch=3（粗略来看应该在第5个epoch左右可以达到预测准确率的最高值）训练完全部1479支股票也至少需要3*50min*1479=221850min=3697.5h≈154days】
所以我尝试预测000002这支股票，epoch=3时模型在训练集上的准确率就可以达到94%以上，在测试集上的准确率可以达到90.23%以上。

但目前来看，此代码具有相当的可行性，预测准确率很高，运行CNN stock all.ipynb代码即可得到
（1）生产保存每个股票的预测情况trend/code.csv文件，日期、code、预测涨跌、真实涨跌4个字段；
（2）存储所有股票的F1、accuracy、score，存入统计文件score.csv中，有code, F1, score三列。


CNN stock all.ipynb为执行代码。
将执行代码放置在sgym目录下即可。

原本采取pickle存放数据，以方便后面直接调用，但由于train_data过于庞大（超过2G，需要使用bytearray形式存入，但如此存入后数据格式产生变化，所以如果仍旧使用该数据集则不考虑使用pickle的方式存储）
train_data.pkl和train_label.pkl为存储训练数据和训练标签的文件，可以直接使用如下代码打开文件，并直接
#打开文件
pickle_open = open('train_data.pkl','rb')
train_data = pickle.load(pickle_open)   #重新导入数据

pickle_open = open('train_label.pkl','rb')
train_label = pickle.load(pickle_open)   #重新导入数据

